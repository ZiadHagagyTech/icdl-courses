<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>ملفات المشتركين | ICDL أكاديمي</title>
  <link rel="stylesheet" href="assets/css/index.css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <link href="https://fonts.googleapis.com/css?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
  <style>
    body {
      background: #f6f9fc;
      font-family: 'Cairo', Arial, sans-serif;
      margin: 0;
      padding: 0;
    }
    .dashboard-hero {
      background: linear-gradient(120deg, #0069d9 80%, #eec60a 100%);
      color: #fff;
      padding: 40px 0 20px 0;
      text-align: center;
    }
    .dashboard-hero h1 {
      font-size: 2.1em;
      font-weight: 900;
      margin-bottom: 10px;
    }
    .dashboard-hero p {
      font-size: 1.1em;
      font-weight: 700;
      color: #eec60a;
    }
    .dashboard-section {
      max-width: 450px;
      margin: 30px auto 0 auto;
      background: #fff;
      border-radius: 18px;
      box-shadow: 0 2px 8px #0069d922;
      padding: 28px 20px;
      box-sizing: border-box;
      width: 100%;
      min-height: 250px;
      position: relative;
      transition: max-width 0.2s, padding 0.2s;
    }
    .login-form label {
      font-weight: bold;
      display: block;
      margin-bottom: 7px;
      margin-top: 12px;
    }
    .login-form input[type="text"],
    .login-form input[type="password"] {
      width: 100%;
      padding: 10px 12px;
      border-radius: 8px;
      border: 1px solid #eee;
      margin-bottom: 14px;
      font-family: 'Cairo', Arial, sans-serif;
      font-size: 1em;
      background: #f8fafc;
      transition: border .2s;
      outline: none;
      box-sizing: border-box;
    }
    .login-form input:focus {
      border: 1.5px solid #0069d9;
      outline: none;
    }
    .login-form .btn {
      width: 100%;
      margin: 0;
      margin-top: 6px;
    }
    .login-form .login-error {
      color: #e74c3c;
      background: #fff0f0;
      border-radius: 7px;
      text-align: center;
      padding: 7px 0;
      font-size: 1em;
      margin-bottom: 7px;
      margin-top: 8px;
      display: none;
    }
    .user-profile-section {
      background: #f8fafc;
      border-radius: 12px;
      box-shadow: 0 2px 8px #eec60a22;
      padding: 16px 10px;
      margin-bottom: 15px;
      text-align: right;
      display: flex;
      flex-direction: column;
      gap: 9px;
    }
    .user-profile-section .profile-row {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 1.02em;
    }
    .user-profile-section .profile-label { color: #0069d9; font-weight: bold; }
    .certificate-display-section {
      margin-bottom: 18px;
      margin-top: 0;
      background: #fffbe6;
      border-radius: 10px;
      box-shadow: 0 1px 8px #eec60a33;
      padding: 18px 10px 14px 10px;
      text-align: right;
      border: 2px dashed #eec60a;
      color: #0069d9;
      font-size: 1.09em;
      display: none;
      flex-direction: column;
      gap: 11px;
    }
    .certificate-display-section .fa-certificate {
      color: #eec60a;
      margin-left: 6px;
      margin-right: 4px;
      font-size: 1.35em;
    }
    .certificate-link {
      background: #e74c3c;
      color: #fff !important;
      border-radius: 7px;
      padding: 8px 18px;
      text-decoration: none;
      font-weight: bold;
      font-size: 1.06em;
      display: inline-block;
      transition: background 0.2s;
      border: none;
      outline: none;
      margin-right: 0;
      margin-left: 0;
      text-align: center;
    }
    .certificate-link:hover {
      background: #c0392b;
      color: #fff !important;
    }
    .certificate-course-title {
      color: #eec60a;
      font-weight: bold;
      margin-left: 5px;
    }
    .dashboard-btns {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
      justify-content: center;
      margin-bottom: 22px;
      margin-top: 18px;
    }
    .dashboard-btn {
      background: #0069d9;
      color: #fff;
      padding: 15px 34px;
      border-radius: 12px;
      border: none;
      font-size: 1.11em;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 2px 8px #0069d933;
      transition: background 0.2s, transform 0.2s;
      display: flex;
      align-items: center;
      gap: 7px;
    }
    .dashboard-btn:hover {
      background: #eec60a;
      color: #222;
      transform: translateY(-3px) scale(1.04);
    }
    .modal-bg {
      display: none;
      position: fixed; top: 0; right: 0; left: 0; bottom: 0;
      background: #0007;
      z-index: 9999;
      justify-content: center;
      align-items: center;
    }
    .modal-bg.active { display: flex; }
    .modal-content {
      background: #fff;
      border-radius: 14px;
      padding: 30px 22px 18px 22px;
      min-width: 270px;
      max-width: 98vw;
      box-shadow: 0 8px 44px #2223;
      position: relative;
      text-align: right;
      max-height: 90vh;
      overflow-y: auto;
    }
    .modal-title {
      font-weight: bold;
      color: #0069d9;
      font-size: 1.19em;
      margin-bottom: 19px;
      text-align: right;
      display: flex;
      align-items: center;
      gap: 7px;
    }
    .modal-close {
      position: absolute; left: 9px; top: 9px;
      background: #eee; color: #c00;
      border-radius: 50%; width: 34px; height: 34px;
      font-size: 1.7em; line-height: 34px; text-align: center;
      cursor: pointer; border: none;
      display: flex; align-items: center; justify-content: center;
      transition: background 0.2s;
    }
    .modal-close:hover {
      background: #eec60a;
      color: #fff;
    }
    .modal-files-list {
      margin-bottom: 6px;
    }
    .modal-files-list .file-item {
      background: #f8fafc;
      border-radius: 7px;
      padding: 10px 14px;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 1em;
      box-shadow: 0 1px 4px #eec60a22;
    }
    .modal-files-list .file-item i {
      color: #eec60a;
      font-size: 1.1em;
    }
    .modal-files-list .download-link {
      background: #0069d9;
      color: #fff;
      border-radius: 5px;
      padding: 5px 10px;
      font-size: 0.98em;
      text-decoration: none;
      transition: background 0.2s;
      margin-right: 7px;
    }
    .modal-files-list .download-link:hover {
      background: #eec60a;
      color: #222;
    }
    .support-question-section {
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 1px 4px #0069d911;
      padding: 18px 10px 13px 10px;
      margin-bottom: 11px;
      margin-top: 30px;
      text-align: right;
    }
    .support-question-section h4 {
      color: #222;
      font-size: 1.12em;
      font-weight: bold;
      margin-bottom: 11px;
      text-align: right;
      letter-spacing: 0.5px;
    }
    .support-question-section form {
      display: flex;
      flex-direction: column;
      gap: 7px;
      align-items: flex-end;
    }
    .support-question-section textarea {
      width: 100%;
      min-height: 55px;
      border-radius: 8px;
      border: 1.5px solid #eee;
      resize: vertical;
      font-size: 1em;
      padding: 7px 8px;
      font-family: 'Cairo', Arial, sans-serif;
      background: #f8fafc;
      transition: border .2s;
      outline: none;
      margin-bottom: 7px;
      direction: rtl;
      text-align: right;
    }
    .support-question-section textarea:focus {
      border: 1.5px solid #0069d9;
      outline: none;
      background: #f6f9fc;
    }
    .support-question-section button {
      background: #2453d1;
      color: #fff;
      border-radius: 7px;
      padding: 7px 18px;
      border: none;
      font-weight: bold;
      font-size: 1.06em;
      cursor: pointer;
      align-self: flex-end;
      transition: background 0.2s;
      margin-bottom: 7px;
      margin-top: 0;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .support-question-section button i {
      font-size: 1.06em;
      margin-left: 2px;
    }
    .support-question-section button:hover { background: #e74c3c; color: #fff;}
    .support-question-section .support-success,
    .support-question-section .support-error {
      font-size: 1.05em;
      margin-top: 7px;
      text-align: right;
      display: block;
      padding-right: 2px;
      padding-left: 2px;
      line-height: 1.7;
    }
    .support-question-section .support-success {
      color: #218838;
      margin-bottom: 2px;
    }
    .support-question-section .support-error {
      color: #c0392b;
      margin-bottom: 2px;
    }
    .dashboard-section .logout-btn {
      display: none;
      margin: 18px auto 0 auto;
      background: #e74c3c;
      color: #fff;
      border-radius: 7px;
      padding: 8px 14px;
      border: none;
      font-weight: bold;
      font-size: 1.03em;
      cursor: pointer;
      width: 100%;
      max-width: 180px;
      transition: background 0.2s;
    }
    .dashboard-section .logout-btn:hover {
      background: #c0392b;
    }
    @media (max-width: 600px) {
      .dashboard-section {
        max-width: 97vw;
        padding: 12px 4vw 17px 4vw;
      }
      .modal-content {
        padding: 12px 2vw 17px 2vw;
      }
      .file-item, .modal-files-list .file-item {
        padding: 7px 2vw;
      }
      .certificate-display-section {
        padding: 9px 2vw 8px 2vw;
      }
    }
    @media (max-width: 430px) {
      .dashboard-hero h1 { font-size: 1.2em;}
      .dashboard-hero p { font-size: 1em;}
      .dashboard-section { padding: 7px 2vw;}
    }
  </style>
</head>
<body>
  <header>
    <div class="navbar">
      <div class="logo"><i class="fa-solid fa-laptop-code"></i> ICDL - Ziad Hagagy</div>
      <nav id="mainNav">
        <a href="index.html"><i class="fa fa-home"></i> الرئيسية</a>
        <a href="courses.html"><i class="fa fa-book-open"></i> الدورات</a>
        <a href="register.html"><i class="fa fa-user-plus"></i> الحجز</a>
        <a href="dashboard.html" class="active"><i class="fa fa-user-shield"></i> ملفات المشتركين</a>
      </nav>
      <div class="hamburger" id="hamburgerBtn"><i class="fa fa-bars"></i></div>
    </div>
    <div class="mobile-nav" id="mobileNav">
      <a href="index.html"><i class="fa fa-home"></i> الرئيسية</a>
      <a href="courses.html"><i class="fa fa-book-open"></i> الدورات</a>
      <a href="register.html"><i class="fa fa-user-plus"></i> الحجز</a>
      <a href="dashboard.html" class="active"><i class="fa fa-user-shield"></i> ملفات المشتركين</a>
      <span class="close-mobile" id="closeMobile"><i class="fa fa-times"></i></span>
    </div>
  </header>

  <section class="dashboard-hero">
    <h1>ملفات المشتركين</h1>
    <p>سجّل دخولك واطلع على ملفاتك الخاصة بالدورات التي اشتركت بها</p>
  </section>

  <section class="dashboard-section">
    <!-- تسجيل الدخول -->
    <form class="login-form" id="loginForm" autocomplete="off">
      <div class="login-error" id="loginError">اسم المستخدم أو كلمة المرور غير صحيحة</div>
      <label for="username">اسم المستخدم</label>
      <input type="text" id="username" name="username" required placeholder="أدخل اسم المستخدم">
      <label for="password">الرقم السري</label>
      <input type="password" id="password" name="password" required placeholder="أدخل الرقم السري">
      <button type="submit" class="btn big-btn"><i class="fa fa-lock"></i> دخول</button>
    </form>

    <div class="user-profile-section" id="userProfileSection" style="display:none">
      <div class="profile-row"><span class="profile-label">الاسم:</span> <span id="profileName"></span></div>
      <div class="profile-row"><span class="profile-label">تاريخ بداية الكورس:</span> <span id="profileDate"></span></div>
    </div>

    <div class="certificate-display-section" id="certificateDisplay"></div>

    <div class="dashboard-btns" id="dashboardBtns" style="display:none">
      <button class="dashboard-btn" id="btnIcdl"><i class="fa fa-folder-open"></i> ملفات ICDL</button>
      <button class="dashboard-btn" id="btnEnglish"><i class="fa fa-folder-open"></i> ملفات اللغة الإنجليزية</button>
    </div>

    <div class="modal-bg" id="modalBg">
      <div class="modal-content">
        <button class="modal-close" id="modalClose" title="إغلاق"><i class="fa fa-times"></i></button>
        <div class="modal-title" id="modalTitle">
          <i class="fa fa-folder-open"></i> ملفات الدورة
        </div>
        <div class="modal-files-list" id="modalFilesList">
          <!-- سيتم ملؤها ديناميكيا -->
        </div>
      </div>
    </div>

    <div class="support-question-section">
      <h4>إرسال سؤال أو استفسار للدعم</h4>
      <form id="supportForm">
        <textarea id="supportMessage" placeholder="اكتب سؤالك أو استفسارك هنا"></textarea>
        <button type="submit"><i class="fa fa-paper-plane"></i> إرسال</button>
        <div class="support-success" id="supportSuccess" style="display:none;">تم إرسال سؤالك بنجاح!</div>
        <div class="support-error" id="supportError" style="display:none;">حدث خطأ أثناء الإرسال، حاول مرة أخرى.</div>
      </form>
    </div>
    <button class="logout-btn" id="logoutBtn" style="display:none;"><i class="fa fa-sign-out-alt"></i> تسجيل الخروج</button>
  </section>

  <nav class="bottom-nav" id="bottomNav">
    <a href="index.html"><i class="fa fa-home"></i><span>الرئيسية</span></a>
    <a href="courses.html"><i class="fa fa-book-open"></i><span>الدورات</span></a>
    <a href="register.html"><i class="fa fa-user-plus"></i><span>الحجز</span></a>
    <a href="dashboard.html" class="active"><i class="fa fa-user-shield"></i><span>الملفات</span></a>
  </nav>

  <footer class="main-footer">
    <style>
      .main-footer {
        background: linear-gradient(120deg, #1b2d53 80%, #eec60a 100%);
        color: #fff;
        padding: 0;
        margin-top: 40px;
        font-family: 'Cairo', Arial, sans-serif;
        border-top-left-radius: 30px;
        border-top-right-radius: 30px;
        box-shadow: 0 -2px 16px #2224a12d;
        overflow: hidden;
        position: relative;
        z-index: 1;
      }
      .footer-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
        max-width: 1200px;
        margin: auto;
        padding: 30px 18px 10px 18px;
        gap: 24px;
      }
      .footer-col {
        flex: 1 1 220px;
        margin-bottom: 12px;
        min-width: 200px;
      }
      .footer-logo {
        font-size: 1.22em;
        font-weight: bold;
        letter-spacing: 2px;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .footer-logo i {
        color: #eec60a;
        font-size: 1.4em;
      }
      .footer-col p {
        color: #f7f7f7;
        font-size: 1.07em;
        margin-bottom: 6px;
        line-height: 1.7;
      }
      .footer-col h4 {
        color: #eec60a;
        font-size: 1.13em;
        font-weight: bold;
        margin-bottom: 8px;
        margin-top: 0;
      }
      .footer-col.links h4 {
        margin-bottom: 7px;
        margin-top: 0;
        padding-top: 0;
      }
      .footer-col ul {
        list-style: none;
        padding: 0;
        margin: 0;
      }
      .footer-col ul li {
        margin-bottom: 7px;
      }
      .footer-col ul li a {
        color: #fff;
        text-decoration: none;
        font-size: 1.09em;
        display: flex;
        align-items: center;
        gap: 8px;
        transition: color 0.2s;
        line-height: 1.7;
      }
      .footer-col ul li a:hover {
        color: #eec60a;
        text-decoration: underline;
      }
      .footer-col.contact p {
        font-size: 1.07em;
        margin: 0 0 7px 0;
        display: flex;
        align-items: center;
        gap: 7px;
      }
      .footer-social {
        margin-top: 7px;
        display: flex;
        gap: 12px;
        justify-content: flex-start;
      }
      .footer-social a {
        color: #fff;
        background: #eec60a;
        border-radius: 50%;
        padding: 8px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-size: 1.13em;
        transition: background 0.2s, color 0.2s, transform 0.2s;
      }
      .footer-social a:hover {
        background: #fff;
        color: #1b2d53;
        transform: scale(1.13) rotate(-8deg);
      }
      .footer-bottom {
        background: #142042;
        color: #eec60a;
        text-align: center;
        padding: 10px 0 7px 0;
        font-size: 1.08em;
        letter-spacing: 0.5px;
        border-bottom-left-radius: 14px;
        border-bottom-right-radius: 14px;
        margin-top: 0;
        position: relative;
        z-index: 2;
        width: 100%;
      }
      .footer-copyright {
        color: #fff;
        font-size: 0.96em;
        margin-top: 7px;
        margin-bottom: 0;
        opacity: 0.95;
        text-align: center;
        letter-spacing: .2px;
        width: 100%;
        background: none;
        border: none;
        padding: 0;
        line-height: 1.7;
        display: block;
      }
      @media (max-width: 900px) {
        .footer-container {
          flex-direction: column;
          align-items: flex-start;
          gap: 0;
          padding: 18px 5vw 7px 5vw;
        }
        .footer-col {
          min-width: unset;
          width: 100%;
          margin-bottom: 10px;
        }
        .footer-col.links h4 {
          margin-bottom: 7px;
        }
      }
      @media (max-width: 600px) {
        .main-footer {
          border-radius: 17px 17px 0 0;
          margin-top: 18px;
          padding-bottom: 60px;
        }
        .footer-container {
          padding: 11px 2vw 4px 2vw;
          gap: 0;
        }
        .footer-col {
          margin-bottom: 7px;
          padding-left: 0;
          padding-right: 0;
        }
        .footer-logo { font-size: 1.04em;}
        .footer-bottom { font-size: 0.97em;}
        .footer-col,
        .footer-col * {
          text-align: center !important;
          justify-content: center !important;
          align-items: center !important;
        }
        .footer-col h4 {
          margin-bottom: 6px;
        }
        .footer-social {
          justify-content: center !important;
          margin-bottom: 5px;
          margin-top: 5px;
        }
        .copy{
          margin-bottom: 1rem;
        }
      }
      @media (max-width: 400px) {
        .footer-container { padding: 7px 1vw 3px 1vw; }
        .footer-col h4 { font-size: 1em; }
        .footer-bottom { font-size: 0.93em;}
      }
    </style>
    <div class="footer-container">
      <div class="footer-col brand">
        <div class="footer-logo">
          <i class="fa-solid fa-laptop-code"></i>
          <span>ICDL - Ziad Hagagy</span>
        </div>
        <p>تدريب احترافي وعملي في مجال الحاسوب بشهادات معتمدة ودعم مستمر.</p>
      </div>
      <div class="footer-col links">
        <h4>روابط سريعة</h4>
        <ul>
          <li><a href="index.html"><i class="fa fa-home"></i> الرئيسية</a></li>
          <li><a href="courses.html"><i class="fa fa-book-open"></i> الدورات</a></li>
          <li><a href="register.html"><i class="fa fa-user-plus"></i> الحجز</a></li>
          <li><a href="dashboard.html"><i class="fa fa-user-shield"></i> ملفات المشتركين</a></li>
        </ul>
      </div>
      <div class="footer-col contact">
        <h4>تواصل معنا</h4>
        <p><i class="fa fa-envelope"></i> info@icdl-academy.com</p>
        <p><i class="fa fa-phone"></i> 01012345678</p>
        <div class="footer-social">
          <a href="#"><i class="fab fa-facebook-f"></i></a>
          <a href="#"><i class="fab fa-whatsapp"></i></a>
          <a href="#"><i class="fab fa-instagram"></i></a>
        </div>
      </div>
    </div>
    <div class="footer-bottom copy">
      جميع الحقوق محفوظة &copy; 2025 ICDL م/ زياد حجاجي
    </div>
  </footer>
  <script>
    let usersData = [];
    let currentUser = null;

    function fetchUsersDataAndUpdateView() {
      fetch('data/users-course1.json?rnd=' + Date.now())
        .then(response => response.json())
        .then(data => {
          usersData = data;
          // جلب اسم المستخدم من التخزين المحلي
          const savedUser = localStorage.getItem("icdl_user");
          const userObj = savedUser ? JSON.parse(savedUser) : null;
          if(userObj && userObj.username){
            // احصل على أحدث بيانات المستخدم من ملف json بناءً على اسم المستخدم
            currentUser = usersData.find(u => u.username === userObj.username);
            if(currentUser){
              localStorage.setItem("icdl_user", JSON.stringify(currentUser));
              showProfileInfo();
              showUserSection();
            }
          }
        });
    }

    window.addEventListener('DOMContentLoaded', function() {
      fetchUsersDataAndUpdateView();
    });

    const loginForm = document.getElementById('loginForm');
    const loginError = document.getElementById('loginError');
    const userProfileSection = document.getElementById('userProfileSection');
    const certificateDisplay = document.getElementById('certificateDisplay');
    const dashboardBtns = document.getElementById('dashboardBtns');
    const btnIcdl = document.getElementById('btnIcdl');
    const btnEnglish = document.getElementById('btnEnglish');
    const logoutBtn = document.getElementById('logoutBtn');
    const modalBg = document.getElementById('modalBg');
    const modalClose = document.getElementById('modalClose');
    const modalTitle = document.getElementById('modalTitle');
    const modalFilesList = document.getElementById('modalFilesList');
    const profileName = document.getElementById('profileName');
    const profileDate = document.getElementById('profileDate');
    const supportForm = document.getElementById('supportForm');
    const supportMessage = document.getElementById('supportMessage');
    const supportSuccess = document.getElementById('supportSuccess');
    const supportError = document.getElementById('supportError');

    loginForm.addEventListener('submit', function(e) {
      e.preventDefault();
      const username = loginForm.username.value.trim();
      const password = loginForm.password.value.trim();
      fetch('data/users-course1.json?rnd=' + Date.now())
        .then(response => response.json())
        .then(data => {
          usersData = data;
          const user = usersData.find(u => u.username === username && u.password === password);
          if(user){
            currentUser = user;
            localStorage.setItem("icdl_user", JSON.stringify(user));
            showProfileInfo();
            showUserSection();
          }else{
            loginError.style.display = 'block';
          }
        });
    });

    function showProfileInfo(){
      profileName.textContent = currentUser.name || '-';
      profileDate.textContent = currentUser.signupDate || '-';
      userProfileSection.style.display = 'flex';
      showCertificateSection();
    }

    function showUserSection(){
      loginForm.style.display = 'none';
      loginError.style.display = 'none';
      dashboardBtns.style.display = 'flex';
      logoutBtn.style.display = 'block';
    }

    function showCertificateSection(){
      if (!currentUser || !currentUser.courses) {
        certificateDisplay.style.display = 'none';
        return;
      }
      let certHtml = "";
      let anyCert = false;
      currentUser.courses.forEach(course => {
        if (course.certificateAvailable && course.certificate) {
          anyCert = true;
          certHtml += `
            <div>
              <span><i class="fa fa-certificate"></i> شهادة التقدير متاحة للتحميل للدورة: <span class="certificate-course-title">${course.name}</span></span>
              <a class="certificate-link" href="${course.certificate}" download>تحميل الشهادة</a>
            </div>
          `;
        }
      });
      if (!anyCert) {
        certificateDisplay.style.display = 'flex';
        certificateDisplay.innerHTML = `<span><i class="fa fa-certificate"></i> شهادة التقدير غير متاحة حاليًا لأي دورة.</span>`;
      } else {
        certificateDisplay.style.display = 'flex';
        certificateDisplay.innerHTML = certHtml;
      }
    }

    btnIcdl.addEventListener('click', function(){
      openModalWithFiles('ICDL');
    });
    btnEnglish.addEventListener('click', function(){
      openModalWithFiles('اللغة الإنجليزية');
    });

    function openModalWithFiles(courseName){
      if(!currentUser || !currentUser.courses) return;
      const course = currentUser.courses.find(c => c.name === courseName);
      modalTitle.innerHTML = `<i class="fa fa-folder-open"></i> ملفات ${courseName}`;
      if(course && course.files && course.files.length > 0){
        modalFilesList.innerHTML = course.files.map(f =>
          `<div class="file-item">
            <i class="fa fa-file-download"></i>
            <span class="filename">${f.name}</span>
            <a class="download-link" href="${f.url}" data-filename="${f.name}" download>عرض</a>
          </div>`
        ).join('');
      }else{
        modalFilesList.innerHTML = '<div>لا توجد ملفات متاحة لهذه الدورة حالياً.</div>';
      }
      modalBg.classList.add('active');
    }
    modalClose.addEventListener('click', ()=>modalBg.classList.remove('active'));
    modalBg.addEventListener('click', (e)=>{ if(e.target === modalBg) modalBg.classList.remove('active'); });

    logoutBtn.addEventListener('click', function(){
      currentUser = null;
      localStorage.removeItem("icdl_user");
      userProfileSection.style.display = 'none';
      dashboardBtns.style.display = 'none';
      logoutBtn.style.display = 'none';
      certificateDisplay.style.display = 'none';
      loginForm.style.display = 'block';
      loginForm.reset();
    });

    loginForm.username.addEventListener('input', () => loginError.style.display = 'none');
    loginForm.password.addEventListener('input', () => loginError.style.display = 'none');

    const myWhatsappNumber = "201027888008";
    supportForm.addEventListener('submit', function(e){
      e.preventDefault();
      supportSuccess.style.display = 'none';
      supportError.style.display = 'none';
      const msg = supportMessage.value.trim();
      if(!msg) {
        supportError.textContent = 'يرجى كتابة سؤالك أولاً';
        supportError.style.display = 'block';
        return;
      }
      if (!currentUser || !currentUser.name || !currentUser.signupDate) {
        supportError.textContent = 'يجب تسجيل الدخول أولاً.';
        supportError.style.display = 'block';
        return;
      }
      const fullMsg = ` الاسم: ${currentUser.name}%0A تاريخ التسجيل: ${currentUser.signupDate}%0A السؤال أو الاستفسار:%0A${encodeURIComponent(msg)}`;
      const whatsappUrl = `https://wa.me/${myWhatsappNumber}?text=${fullMsg}`;
      window.open(whatsappUrl, "_blank");
      supportSuccess.textContent = 'سيتم تحويلك إلى واتساب لإرسال سؤالك مباشرة.';
      supportSuccess.style.display = 'block';
      supportMessage.value = '';
    });

    // تحديث تلقائي كل دقيقة
    setInterval(fetchUsersDataAndUpdateView, 60000);
  </script>
  <script src="assets/js/main.js"></script>
</body>
</html>
